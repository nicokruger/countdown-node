<script>

$(function () {
    $("#newcountdownForm").bind("submit", newCountdown);
});

var newCountdown = function (e) {
    e.preventDefault();
    var ed;
    try {
        ed = moment($("#countdownDatetime").val(), "YYYY-MM-DDTHH:mm");
    } catch (err) {
        alert("cannot parse date: " + err);
        return;
    }
    
    if (ed == null ) {
        alert("invalid date");
        return;
    }
    var data = {
        name: $("#countdownName").val(),
        tags: $("#countdownTags").val(),
        eventDate:  ed.native().getTime()
    };

    $.ajax({
        url: "http://" + window.location.hostname + ":55555/countdown/new", 
        data: data,
        type: "POST",
        dataType: "json",
        success: function (o) {
            window.location.href = "/" + o.countdowns[0].url;
        }, 
        error: function (e) {
            $("#info").html("An error occurred... Please try again");
        }
    });
};
    
</script>

<div class="addcounter">
    <form id="newcountdownForm" method="post">

        <fieldset>
            <legend>Add new counter</legend>

            <div class="clearfix">
                <label for="countdownTags">Name:</label>
                <div class="input">
                    <input class="xlarge" required type="text" name="countdownName" id="countdownName" value="" />
                </div>
            </div>

            <div class="clearfix">
                <label for="countdownTags">Tags:</label>
                <div class="input">
                    <input class="xlarge" type="text" name="countdownTags" id="countdownTags" value="" />
                </div>
            </div>

            <div class="clearfix">
                <label for="countdownDatetime">When<br/></label>
                <div class="input">
                    <input required type="datetime-local/" name="countdownDatetime" id="countdownDatetime" value="" />
                    <span class="help-block"> (YY-MM-DDThh:mm eg. 2011-12-01T13:00)</span>
                </div>
            </div>

            <div class="actions">
                <input type="submit" class="btn primary" value="Add Countdown" />
            </div>
        </fieldset>            
    </form> 
</div>

<div id="info">
</div>
